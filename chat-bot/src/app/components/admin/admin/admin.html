<div class="admin-layout">
  
  <aside class="sidebar" [class.open]="isMobileMenuOpen">
    <div class="brand">
      <h2>Love<span>Care</span></h2>
      <p>Painel Administrativo</p>
    </div>
    
    <nav class="nav-menu">
      <button (click)="activeTab = 'dashboard'; isMobileMenuOpen=false" class="nav-btn" [class.active]="activeTab === 'dashboard'">
        <span class="icon">ğŸ“Š</span> Dashboard
      </button>
      <button (click)="activeTab = 'editor'; isMobileMenuOpen=false" class="nav-btn" [class.active]="activeTab === 'editor'">
        <span class="icon">âœï¸</span> Editar Fluxo
      </button>
    </nav>

    <div class="sidebar-footer">
      <button (click)="goHome()" class="btn-secondary full-width">â¬… Sair / Ver Site</button>
    </div>
  </aside>

  <div class="overlay" *ngIf="isMobileMenuOpen" (click)="toggleMobileMenu()"></div>

  <main class="main-content">
    <header class="mobile-header">
      <div class="brand-mobile">Love<span>Care</span></div>
      <button class="hamburger-btn" (click)="toggleMobileMenu()">â˜°</button>
    </header>

    <!-- DASHBOARD -->
    <div *ngIf="activeTab === 'dashboard'" class="view-container fade-in">
       <div class="page-header"><h1>VisÃ£o Geral</h1><p>MÃ©tricas.</p></div>
       <div class="kpi-grid">
          <div class="kpi-card"><div class="kpi-value">{{ totalInteractions }}</div><div class="kpi-label">InteraÃ§Ãµes</div><div class="kpi-bar green"></div></div>
          <div class="kpi-card"><div class="kpi-value">{{ totalVisits }}</div><div class="kpi-label">Visitas</div><div class="kpi-bar purple"></div></div>
          <div class="kpi-card highlight"><div class="kpi-value">{{ conversionRate }}</div><div class="kpi-label">ConversÃ£o</div><div class="kpi-bar pink"></div></div>
       </div>
       <div class="chart-section">
         <h3>ğŸ”¥ Assuntos Mais Buscados</h3>
         <div class="ranking-list">
            <div *ngFor="let item of topInterests" class="ranking-item">
               <div class="rank-info"><span class="rank-name">{{item.name}}</span><span class="rank-val">{{item.value}}</span></div>
               <div class="progress-track"><div class="progress-fill" [style.width.%]="(item.value/totalInteractions)*100"></div></div>
            </div>
            <div *ngIf="topInterests.length===0" class="empty-state"><p>Sem dados ainda.</p></div>
         </div>
       </div>
    </div>

    <!-- EDITOR -->
    <!-- EDITOR DE FLUXO -->
    <div *ngIf="activeTab === 'editor'" class="view-container fade-in">
      <div class="page-header flex-between">
        <div>
          <h1>Editor de Fluxo</h1>
          <p>Gerencie as perguntas e respostas do robÃ´.</p>
        </div>
        <button class="btn-primary" (click)="save()" [disabled]="isLoading">
          {{ isLoading ? 'Salvando...' : 'ğŸ’¾ Salvar AlteraÃ§Ãµes' }}
        </button>
      </div>

      <div class="cards-wrapper">
        
        <!-- O CLIQUE AQUI SÃ“ SETA A VARIÃVEL PARA TRUE -->
        <div class="add-card-placeholder" (click)="isModalOpen = true">
          <div class="plus-circle">+</div>
          <p>Criar Novo Passo</p>
        </div>

        <div *ngFor="let card of cards; let i = index" class="flow-card">
           <!-- ... (ConteÃºdo do card igual) ... -->
           <div class="card-header-strip">
            <span class="badge-id">{{ card.id }}</span>
            <button class="btn-icon-trash" (click)="removeCard(i)" *ngIf="card.id !== 'start'">ğŸ—‘ï¸</button>
          </div>
          <div class="card-body">
            <div class="form-group"><label>Mensagem</label><textarea [(ngModel)]="card.text" rows="3" class="form-control"></textarea></div>
            <div class="options-group">
              <div class="options-list">
                <div *ngFor="let opt of card.options; let j = index" class="opt-row">
                  <input [(ngModel)]="opt.label" class="form-control small" placeholder="Texto">
                  <input [(ngModel)]="opt.nextStep" class="form-control small" placeholder="Destino">
                  <button (click)="removeOption(card, j)" class="btn-icon-remove">Ã—</button>
                </div>
              </div>
              <button class="btn-secondary small-btn full-width" (click)="addOption(card)">+ BotÃ£o</button>
            </div>
          </div>
        </div>

      </div>
    </div>

  </main>

  <!-- --- AQUI ESTÃ O NOVO COMPONENTE DE MODAL --- -->
  <!-- SÃ³ aparece se isModalOpen for true -->
  <app-add-card 
    *ngIf="isModalOpen"
    [existingIds]="getCardIds()"
    (confirmAdd)="handleNewCard($event)"
    (close)="isModalOpen = false">
  </app-add-card>

</div>



 